\nimport pandas as pd\nimport pandas_ta as ta\nfrom backtesting import Backtest, Strategy\nimport numpy as np\n\nclass TrendFollowingStrategy(Strategy):\n    # Strategy parameters\n    ema_fast = 20\n    ema_slow = 50\n    adx_period = 14\n    adx_threshold = 25\n    atr_period = 14\n    risk_per_trade = 0.02  # 2% risk per trade\n    \n    def init(self):\n        # Calculate technical indicators\n        self.ema_fast = self.I(ta.ema, self.data.Close, self.ema_fast)\n        self.ema_slow = self.I(ta.ema, self.data.Close, self.ema_slow)\n        \n        # ADX for trend strength\n        adx_data = ta.adx(self.data.High, self.data.Low, self.data.Close, length=self.adx_period)\n        self.adx = self.I(lambda: adx_data[f\'ADX_{self.adx_period}\'])\n        self.pdi = self.I(lambda: adx_data[f\'DMP_{self.adx_period}\'])\n        self.ndi = self.I(lambda: adx_data[f\'DMN_{self.adx_period}\'])\n        \n        # ATR for volatility and stop loss\n        atr_data = ta.atr(self.data.High, self.data.Low, self.data.Close, length=self.atr_period)\n        self.atr = self.I(lambda: atr_data)\n        \n        # MACD for momentum confirmation\n        macd_data = ta.macd(self.data.Close)\n        self.macd = self.I(lambda: macd_data[\'MACD_12_26_9\'])\n        self.macd_signal = self.I(lambda: macd_data[\'MACDs_12_26_9\'])\n        self.macd_histogram = self.I(lambda: macd_data[\'MACDh_12_26_9\'])\n        \n        # Supertrend for trend direction\n        supertrend_data = ta.supertrend(self.data.High, self.data.Low, self.data.Close, length=10, multiplier=3)\n        self.supertrend = self.I(lambda: supertrend_data[\'SUPERT_10_3.0\'])\n        self.supertrend_direction = self.I(lambda: supertrend_data[\'SUPERTd_10_3.0\'])\n\n    def next(self):\n        current_price = self.data.Close[-1]\n        \n        # Skip if we don\'t have enough data\n        if len(self.data) < max(self.ema_slow, self.adx_period, self.atr_period) + 10:\n            return\n        \n        # Calculate position size based on ATR stop loss\n        if self.atr[-1] > 0:\n            stop_distance = self.atr[-1] * 2  # 2x ATR for stop loss\n            position_size = (self.equity * self.risk_per_trade) / stop_distance\n            position_size = min(position_size, self.equity * 0.1)  # Max 10% per trade\n        else:\n            position_size = self.equity * 0.05  # Default 5% position\n        \n        # Trend following conditions\n        trend_up_conditions = (\n            self.ema_fast[-1] > self.ema_slow[-1] and  # Fast EMA above slow EMA\n            self.adx[-1] > self.adx_threshold and      # Strong trend\n            self.pdi[-1] > self.ndi[-1] and            # +DI above -DI\n            self.macd[-1] > self.macd_signal[-1] and   # MACD bullish\n            self.supertrend_direction[-1] == 1 and     # Supertrend bullish\n            current_price > self.ema_slow[-1]          # Price above slow EMA\n        )\n        \n        # Trend reversal conditions (exit)\n        trend_reversal_conditions = (\n            self.ema_fast[-1] < self.ema_slow[-1] or   # Fast EMA crosses below slow EMA\n            self.supertrend_direction[-1] == -1 or     # Supertrend turns bearish\n            self.macd[-1] < self.macd_signal[-1] or    # MACD bearish crossover\n            self.pdi[-1] < self.ndi[-1]                # -DI above +DI\n        )\n        \n        # Entry logic\n        if not self.position and trend_up_conditions:\n            # Calculate stop loss price (2x ATR below entry)\n            stop_price = current_price - (self.atr[-1] * 2)\n            self.buy(size=position_size, sl=stop_price)\n        \n        # Exit logic\n        elif self.position and trend_reversal_conditions:\n            self.position.close()\n\n# Example usage (commented out for backtesting.py framework)\n"""\nif __name__ == "__main__":\n    # Load your ETH data\n    data = pd.read_csv(\'eth_data.csv\', parse_dates=[\'date\'], index_col=\'date\')\n    data.columns = [\'Open\', \'High\', \'Low\', \'Close\', \'Volume\']\n    \n    # Run backtest\n    bt = Backtest(data, TrendFollowingStrategy, cash=10000, commission=.002)\n    result = bt.run()\n    print(result)\n    bt.plot()\n"""\n